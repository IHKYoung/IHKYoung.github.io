<!DOCTYPE html>














<script>
    MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
    };

    window.addEventListener('load', (event) => {
        document.querySelectorAll("mjx-container").forEach(function (x) {
            x.parentElement.classList += 'has-jax'
        })
    });
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



<html lang="zh" dir="zh-cn">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ | AhaKnow</title>
<meta name="keywords" content="H.264">
<meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚ å½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -&gt; é‚£å°±éœ€è¦æŒ‰ç…§H">
<meta name="author" content="YOUNG">
<link rel="canonical" href="https://ahaknow.com/posts/know/decode-h.264-lz4-image-frames/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ahaknow.com/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://ahaknow.com/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://ahaknow.com/Q.gif">
<link rel="apple-touch-icon" href="https://ahaknow.com/Q.gif">
<link rel="mask-icon" href="https://ahaknow.com/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://ahaknow.com/posts/know/decode-h.264-lz4-image-frames/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ" />
<meta property="og:description" content="åœ¨ä¸Šä¸€ç¯‡æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚ å½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -&gt; é‚£å°±éœ€è¦æŒ‰ç…§H" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ahaknow.com/posts/know/decode-h.264-lz4-image-frames/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-18T14:43:01+08:00" />
<meta property="article:modified_time" content="2024-04-18T14:43:01+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ"/>
<meta name="twitter:description" content="åœ¨ä¸Šä¸€ç¯‡æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚ å½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -&gt; é‚£å°±éœ€è¦æŒ‰ç…§H"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸš€ å¤©å¤©å‘ä¸Š",
      "item": "https://ahaknow.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸŒŸçŸ¥è¯†",
      "item": "https://ahaknow.com/posts/know/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ",
      "item": "https://ahaknow.com/posts/know/decode-h.264-lz4-image-frames/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ",
  "name": "å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ",
  "description": "åœ¨ä¸Šä¸€ç¯‡æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚ å½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -\u0026gt; é‚£å°±éœ€è¦æŒ‰ç…§H",
  "keywords": [
    "H.264"
  ],
  "articleBody": " åœ¨ä¸Šä¸€ç¯‡æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚\nå½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -\u003e é‚£å°±éœ€è¦æŒ‰ç…§H.264è§£ç \nè§†å·®å›¾åƒé‡‡ç”¨LZ4å‹ç¼© -\u003e è§†å·®å›¾ä¿å­˜çš„16ä½æ— ç¬¦å·æ•´æ•°ï¼Œé‡‡ç”¨LZ4è§£å‹ç¼©ï¼ˆå¼€æºï¼‰\nèƒŒæ™¯çŸ¥è¯† LZ4 LZ4 æ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿçš„å‹ç¼©ç®—æ³•ï¼Œæä¾›äº†å®æ—¶å‹ç¼©é€Ÿåº¦å’Œéå¸¸å¿«çš„è§£å‹ç¼©é€Ÿåº¦ï¼Œç”± Yann Colletï¼ˆFaceBookå¤§ä½¬ï¼‰ å¼€å‘ã€‚å®ƒå±äºæ— æŸå‹ç¼©ç®—æ³•ï¼Œæ„å‘³ç€å‹ç¼©åçš„æ•°æ®å¯ä»¥å®Œå…¨æ¢å¤åˆ°å…¶åŸå§‹å½¢æ€ã€‚LZ4 ä¸»è¦è®¾è®¡ç”¨äºéå¸¸é«˜é€Ÿçš„åœºæ™¯ï¼ˆè§£å‹é€Ÿåº¦å¯ä»¥è¾¾åˆ°æ•°GBæ¯ç§’ï¼‰ï¼Œä¾‹å¦‚å®æ—¶æ•°æ®ä¼ è¾“ã€æ—¥å¿—æ•°æ®å¤„ç†ç­‰ã€‚\nH.264 H.264ï¼Œä¹Ÿè¢«ç§°ä¸ºMPEG-4 AVCï¼ˆAdvanced Video Codingï¼‰ï¼Œæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è§†é¢‘å‹ç¼©æ ‡å‡†ã€‚å®ƒæ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITU-Tï¼‰ä¸‹çš„è§†é¢‘ç¼–ç ä¸“å®¶ç»„ï¼ˆVCEGï¼‰ä»¥åŠè¿åŠ¨å›¾åƒä¸“å®¶ç»„ï¼ˆMPEGï¼‰å…±åŒå¼€å‘çš„ã€‚H.264æ ‡å‡†çš„ç›®æ ‡æ˜¯æä¾›é«˜è´¨é‡çš„è§†é¢‘ä¼ è¾“ï¼ŒåŒæ—¶æ˜¾è‘—é™ä½æ¯”ç‰¹ç‡ï¼Œç›¸å¯¹äºä»¥å‰çš„æ ‡å‡†å¦‚MPEG-2å’ŒMPEG-4 Part 2ï¼Œå®ƒåœ¨ä¿æŒç›¸åŒè§†è§‰è´¨é‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿æ–‡ä»¶å¤§å°å‡å°‘åˆ°åŸæ¥çš„ä¸€åŠä»¥ä¸Šã€‚\nH.264 å’Œ Qt Qt ä½¿ç”¨ Qt Multimedia æ¨¡å—æ¥å¤„ç†å¤šåª’ä½“å†…å®¹ï¼ŒåŒ…æ‹¬è§†é¢‘å’ŒéŸ³é¢‘ã€‚è¿™ä¸ªæ¨¡å—æ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ H.264ã€‚ä½¿ç”¨ Qt Multimediaï¼Œå¼€å‘è€…å¯ä»¥è¾ƒå®¹æ˜“åœ°åœ¨åº”ç”¨ä¸­é›†æˆè§†é¢‘æ’­æ”¾åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¤„ç†åº•å±‚çš„è§†é¢‘è§£ç ã€‚\nQt Multimedia Widgetsï¼šå¯ä»¥ä½¿ç”¨ QMediaPlayer å’Œ QVideoWidget æ¥æ’­æ”¾ H.264 è§†é¢‘ã€‚Qt å¤„ç†å¤šåª’ä½“æµçš„è§£ç å’Œæ¸²æŸ“ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨å¦‚ä½•æ§åˆ¶æ’­æ”¾å™¨å’Œé›†æˆåˆ°UIä¸­ã€‚ è‡ªåŠ¨è§£ç ï¼šQt åº•å±‚ä½¿ç”¨ç³»ç»Ÿçš„ç¼–è§£ç åº“ï¼ˆå¦‚ DirectShow on Windows, GStreamer on Linuxï¼‰æ¥è§£ç è§†é¢‘æµï¼ŒåŒ…æ‹¬ H.264ã€‚è¿™æ„å‘³ç€é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è§£æ H.264 æ•°æ®å¸§ï¼Œé™¤ééœ€è¦éå¸¸å®šåˆ¶åŒ–çš„å¤„ç†ã€‚ FFmpeg FFmpeg æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šåª’ä½“æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€å¥—å…¨é¢çš„åº“å’Œå·¥å…·ï¼Œç”¨äºå¤„ç†è§†é¢‘ã€éŸ³é¢‘å’Œå…¶ä»–å¤šåª’ä½“æ–‡ä»¶å’Œæµã€‚è¿™ä¸ªæ¡†æ¶æ”¯æŒè½¬ç ã€è½¬æµã€æ’­æ”¾å’Œåˆ†æå‡ ä¹æ‰€æœ‰ç±»å‹çš„å¤šåª’ä½“æ•°æ®ã€‚FFmpeg åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦ç»„ä»¶ï¼š\nlibavcodec: æä¾›å¹¿æ³›çš„ç¼–è§£ç å™¨æ”¯æŒï¼Œæ˜¯å¤„ç†è§†é¢‘å’ŒéŸ³é¢‘ç¼–è§£ç çš„æ ¸å¿ƒåº“ã€‚ libavformat: å¤„ç†å¤šç§éŸ³è§†é¢‘å®¹å™¨æ ¼å¼çš„è¾“å…¥å’Œè¾“å‡ºã€‚ libavutil: åŒ…å«ä¸€äº›è¾…åŠ©çš„å®ç”¨åŠŸèƒ½ï¼Œå¦‚æ—¥å¿—ç®¡ç†å’Œé”™è¯¯å¤„ç†ã€‚ libavfilter: æä¾›è§†é¢‘å’ŒéŸ³é¢‘æµçš„è½¬æ¢å’Œæ“ä½œåŠŸèƒ½ã€‚ libswscale: å¤„ç†å›¾åƒè‰²å½©å’Œåƒç´ æ ¼å¼è½¬æ¢ã€‚ libswresample: å¤„ç†éŸ³é¢‘é‡‡æ ·æ•°æ®çš„è½¬æ¢ã€‚ é¡¹ç›®ä¸­ä½¿ç”¨LZ4 é¦–å…ˆå®‰è£… liblz4-devï¼š\nsudo apt update sudo apt install liblz4-dev æœ‰å¯èƒ½ CMake ä»ç„¶æ‰¾ä¸åˆ° LZ4ï¼Œè¿™æ—¶å€™å¯ä»¥æ‰‹åŠ¨æŒ‡å®š LZ4 åº“å’Œå¤´æ–‡ä»¶çš„è·¯å¾„ã€‚é¦–å…ˆéœ€è¦ç¡®å®š liblz4.so å’Œ LZ4 çš„å¤´æ–‡ä»¶ lz4.h çš„ä½ç½®ã€‚è¿™äº›æ–‡ä»¶é€šå¸¸ä½äº /usr/include å’Œ /usr/lib ä¸‹ï¼Œå¦‚æœä¸ç¡®å®šå¯ä»¥é€šè¿‡ find /usr -name lz4.hå‘½ä»¤æŸ¥æ‰¾ ã€‚\nä¿®æ”¹ CMakeLists.txt æ–‡ä»¶ï¼Œæ‰‹åŠ¨è®¾ç½®è·¯å¾„ï¼š\ncmake_minimum_required(VERSION 3.10) project(DataFrameParser) set(CMAKE_CXX_STANDARD 20) set(CMAKE_CXX_STANDARD_REQUIRED True) # Find OpenCV find_package(OpenCV REQUIRED) # Include directories for OpenCV and manually for LZ4 include_directories( ${OpenCV_INCLUDE_DIRS} /usr/include ) # Link directories for LZ4 link_directories(/usr/lib /usr/lib/x86_64-linux-gnu) # Adjust this path according to your system add_executable(DataFrameParser main.cpp) target_link_libraries(DataFrameParser lz4 ${OpenCV_LIBS}) è¿™é‡Œï¼Œè¿™é‡Œä½¿ç”¨äº† link_directories å’Œ target_link_libraries ä¸­ç›´æ¥æŒ‡å®š lz4ï¼Œè€Œä¸æ˜¯ ${LZ4_LIBRARIES}ã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨ find_package æ¥å®šä¹‰ LZ4_LIBRARIES å˜é‡ã€‚\né¡¹ç›®ä¸­ä½¿ç”¨FFmpeg å®‰è£… FFmpeg å’Œç›¸åº”çš„å¼€å‘åº“ï¼š\nsudo apt update sudo apt install ffmpeg sudo apt install libavcodec-dev libavformat-dev libswscale-dev libavutil-dev è¿™äº›å¼€å‘åº“åŒ…æ‹¬ç”¨äºå¤„ç†è§†é¢‘ç¼–è§£ç çš„ libavcodecï¼Œç”¨äºå¤„ç†å¤šåª’ä½“å®¹å™¨æ ¼å¼çš„ libavformatï¼Œä»¥åŠç”¨äºè§†é¢‘ç¼©æ”¾å’Œæ ¼å¼è½¬æ¢çš„ libswscale ç­‰ã€‚\nåœ¨ CMake é¡¹ç›®ä¸­ä½¿ç”¨ FFmpegï¼Œåˆ™éœ€è¦åœ¨ CMakeLists.txt æ–‡ä»¶ä¸­æ­£ç¡®è®¾ç½®æ‰¾åˆ°å’Œé“¾æ¥è¿™äº›åº“ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š\ncmake_minimum_required(VERSION 3.10) project(DataFrameParser) set(CMAKE_CXX_STANDARD 20) set(CMAKE_CXX_STANDARD_REQUIRED True) # Find OpenCV find_package(OpenCV REQUIRED) # Find FFmpeg components find_package(PkgConfig REQUIRED) pkg_check_modules(AVCODEC REQUIRED libavcodec) pkg_check_modules(AVFORMAT REQUIRED libavformat) pkg_check_modules(SWSCALE REQUIRED libswscale) pkg_check_modules(AVUTIL REQUIRED libavutil) include_directories( ${OpenCV_INCLUDE_DIRS} ${AVCODEC_INCLUDE_DIRS} ${AVFORMAT_INCLUDE_DIRS} ${SWSCALE_INCLUDE_DIRS} ${AVUTIL_INCLUDE_DIRS} ) add_executable(DataFrameParser main.cpp) target_link_libraries(DataFrameParser ${OpenCV_LIBS} ${AVCODEC_LIBRARIES} ${AVFORMAT_LIBRARIES} ${SWSCALE_LIBRARIES} ${AVUTIL_LIBRARIES} ) éš¾ç‚¹åˆ†æ ä¸ä½¿ç”¨QTï¼Œå¸Œæœ›èƒ½å¤Ÿè½¬æ¢ä¸ºOpenCVå¤„ç†çš„å›¾åƒï¼Œå› æ­¤éœ€è¦ä½¿ç”¨åˆ°FFmpegã€‚\nç”±äºå¤„ç†çš„å­—èŠ‚æµï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿è¯èƒ½å¤ŸæŒç»­çš„è§£ç ã€‚ä¹Ÿå°±æ˜¯éœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç„¶åæŒç»­è¿è¡Œï¼Œè¿è¡Œç»“æŸåé‡Šæ”¾èµ„æºã€‚\nä½¿ç”¨ FFmpeg è§£æ H.264 å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç† åˆå§‹åŒ–å’Œé…ç½®è§£ç å™¨ï¼ˆè¿™éƒ¨åˆ†åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼‰\næŸ¥æ‰¾å¹¶æ‰“å¼€è§£ç å™¨:ä½¿ç”¨ avcodec_find_decoder æ ¹æ®æŒ‡å®šçš„ç¼–è§£ç å™¨IDï¼ˆä¾‹å¦‚ AV_CODEC_ID_H264ï¼‰æ¥æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨ã€‚ç„¶åä½¿ç”¨ avcodec_alloc_context3 å’Œ avcodec_open2 æ¥åˆ†é…å¹¶åˆå§‹åŒ–è§£ç å™¨ä¸Šä¸‹æ–‡ã€‚ è®¾ç½®è§£ç ä¸Šä¸‹æ–‡:é…ç½®è§£ç å™¨ä¸Šä¸‹æ–‡ï¼Œå¦‚è®¾ç½®æ—¶é—´åŸºã€å»¶è¿Ÿç­‰ã€‚ è§£ç è¿‡ç¨‹\nè¯»å–å’Œå‘é€æ•°æ®åŒ…:ä»æºæ•°æ®ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œæµï¼‰ä¸­è¯»å–æ•°æ®ï¼Œå¹¶æ„å»ºæˆ AVPacketã€‚ä½¿ç”¨ av_read_frame ä»å¤šåª’ä½“æ–‡ä»¶è¯»å–æ•°æ®å¸§æˆ–ä½¿ç”¨ av_init_packet å¤„ç†è‡ªå®šä¹‰çš„æ•°æ®ï¼Œç„¶åä½¿ç”¨ avcodec_send_packet å°†æ•°æ®åŒ…å‘é€ç»™è§£ç å™¨ã€‚ æ¥æ”¶å’Œè§£ç :ä½¿ç”¨ avcodec_receive_frame æ¥æ”¶è§£ç å™¨è¾“å‡ºçš„å¸§ã€‚è¯¥å‡½æ•°ä»è§£ç å™¨ä¸­æå–ä¸€ä¸ªè§£ç å¥½çš„å¸§ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®è§£ç ä¸€ä¸ªå®Œæ•´çš„å¸§ï¼Œå®ƒä¼šè¿”å› EAGAINã€‚ å›¾åƒè½¬æ¢:ä½¿ç”¨ libswscaleï¼ˆæˆ– SwsContextï¼‰å°†è§£ç åçš„å¸§ï¼ˆé€šå¸¸ä¸ºYUVæ ¼å¼ï¼‰è½¬æ¢ä¸ºå…¶ä»–åƒç´ æ ¼å¼ï¼ˆå¦‚RGBï¼‰ï¼Œä»¥ä¾¿äºæ˜¾ç¤ºæˆ–è¿›ä¸€æ­¥å¤„ç†ã€‚ èµ„æºæ¸…ç† é‡Šæ”¾èµ„æº:ä½¿ç”¨ av_frame_freeã€av_packet_free å’Œ avcodec_close é‡Šæ”¾å¸§ã€æ•°æ®åŒ…å’Œå…³é—­è§£ç å™¨ã€‚ ä»£ç å®ç° // å…¨å±€å˜é‡æˆ–ç±»æˆå‘˜å˜é‡ AVCodecContext* context = nullptr; bool initializeDecoder() { AVCodec* codec = avcodec_find_decoder(AV_CODEC_ID_H264); if (!codec) { std::cerr \u003c\u003c \"Codec not found.\\n\"; return false; } context = avcodec_alloc_context3(codec); if (!context) { std::cerr \u003c\u003c \"Could not allocate video codec context.\\n\"; return false; } if (avcodec_open2(context, codec, NULL) \u003c 0) { std::cerr \u003c\u003c \"Could not open codec.\\n\"; avcodec_free_context(\u0026context); return false; } return true; } void cleanupDecoder() { if (context) { avcodec_close(context); avcodec_free_context(\u0026context); } } bool processH264Frame(const std::vector\u003cuint8_t\u003e\u0026 data, cv::Mat\u0026 image) { AVPacket* pkt = av_packet_alloc(); if (!pkt) { std::cerr \u003c\u003c \"Could not allocate AVPacket.\\n\"; return false; } av_init_packet(pkt); // set data source pkt-\u003edata = const_cast\u003cuint8_t*\u003e(data.data()); // Unsafe cast, data must be non-const pkt-\u003esize = data.size(); int ret = avcodec_send_packet(context, pkt); if (ret \u003c 0) { std::cerr \u003c\u003c \"Error sending a packet for decoding.\\n\"; av_packet_free(\u0026pkt); return false; } AVFrame* frame = av_frame_alloc(); ret = avcodec_receive_frame(context, frame); if (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF) { av_frame_free(\u0026frame); av_packet_free(\u0026pkt); return false; } else if (ret \u003c 0) { std::cerr \u003c\u003c \"Error during decoding.\\n\"; av_frame_free(\u0026frame); av_packet_free(\u0026pkt); return false; } // Convert AVFrame to cv::Mat // yuvj420p std::cout \u003c\u003c \"Pixel Format: \" \u003c\u003c av_get_pix_fmt_name(static_cast\u003cAVPixelFormat\u003e(frame-\u003eformat)) \u003c\u003c std::endl; std::cout \u003c\u003c \"Pixel Format Enum: \" \u003c\u003c frame-\u003eformat \u003c\u003c std::endl; SwsContext* img_convert_ctx = sws_getContext(frame-\u003ewidth, frame-\u003eheight, static_cast\u003cAVPixelFormat\u003e(frame-\u003eformat), frame-\u003ewidth, frame-\u003eheight, AV_PIX_FMT_BGR24, SWS_BICUBIC, NULL, NULL, NULL); int linesize[1] = {3 * frame-\u003ewidth}; // RGB stride image = cv::Mat(frame-\u003eheight, frame-\u003ewidth, CV_8UC3); sws_scale(img_convert_ctx, frame-\u003edata, frame-\u003elinesize, 0, frame-\u003eheight, \u0026image.data, linesize); sws_freeContext(img_convert_ctx); av_frame_free(\u0026frame); av_packet_free(\u0026pkt); return true; } ä»£ç åˆ†æ ç”±äºSPSï¼ˆåºåˆ—å‚æ•°é›†ï¼‰å’ŒPPSï¼ˆå›¾åƒå‚æ•°é›†ï¼‰ç­‰å…³é”®è§£ç ä¿¡æ¯é€šå¸¸åªåœ¨è§†é¢‘æµçš„å¼€å§‹éƒ¨åˆ†å‘é€ï¼Œå› æ­¤åªéœ€è¦åˆå§‹åŒ–è§£ç å™¨ä¸€æ¬¡ã€‚ï¼ˆæœ€å¼€å§‹çš„å®ç°æ˜¯æ¯æ¬¡è§£ç å¸§ä¹‹å‰éƒ½é‡æ–°åˆå§‹åŒ–è§£ç å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™äº›å…³é”®ä¿¡æ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œå¯¼è‡´åç»­å¸§æ— æ³•æ­£ç¡®è§£ç ï¼Œè¡¨ç°çš„ç°è±¡æ˜¯å¡åœ¨äº†ç¬¬ä¸€å¸§ç”»é¢ï¼‰ã€‚\nä»¥ä¸‹æ˜¯ä¸Šè¿°ä»£ç çš„é€è¡Œè§£é‡Šï¼š\nåˆå§‹åŒ–è§£ç å™¨ // æ‰¾åˆ°å¹¶ç¡®è®¤è§£ç å™¨ AVCodec* codec = avcodec_find_decoder(AV_CODEC_ID_H264); if (!codec) { std::cerr \u003c\u003c \"Codec not found.\\n\"; return false; } avcodec_find_decoder: è¿™ä¸ªå‡½æ•°ç”¨äºæŸ¥æ‰¾æŒ‡å®šç¼–è§£ç å™¨ï¼ˆè¿™é‡Œæ˜¯H.264ï¼‰ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘è§£ç å™¨çš„æŒ‡é’ˆã€‚ if (!codec): å¦‚æœæ²¡æœ‰æ‰¾åˆ°è§£ç å™¨ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚ // åˆ†é…ç¼–è§£ç å™¨ä¸Šä¸‹æ–‡ AVCodecContext* context = avcodec_alloc_context3(codec); if (!context) { std::cerr \u003c\u003c \"Could not allocate video codec context.\\n\"; return false; } avcodec_alloc_context3: åˆ†é…ä¸€ä¸ªæ–°çš„è§£ç å™¨ä¸Šä¸‹æ–‡ï¼Œå…³è”ç»™å®šçš„ç¼–è§£ç å™¨ã€‚ if (!context): å¦‚æœä¸Šä¸‹æ–‡åˆ†é…å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚ // æ‰“å¼€è§£ç å™¨ if (avcodec_open2(context, codec, NULL) \u003c 0) { std::cerr \u003c\u003c \"Could not open codec.\\n\"; return false; } avcodec_open2: åˆå§‹åŒ–è§£ç å™¨ä¸Šä¸‹æ–‡ä»¥å‡†å¤‡ä½¿ç”¨ï¼Œä¼ å…¥çš„ codec æ˜¯ä¸Šæ–‡æŸ¥æ‰¾å¾—åˆ°çš„ç¼–è§£ç å™¨ã€‚ if (avcodec_open2(...) \u003c 0): å¦‚æœè§£ç å™¨æ‰“å¼€å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚ å¤„ç†å•å¸§æ•°æ® // åˆ†é…æ•°æ®åŒ… AVPacket* pkt = av_packet_alloc(); if (!pkt) { std::cerr \u003c\u003c \"Could not allocate AVPacket.\\n\"; return false; } av_packet_alloc: åˆ†é…ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ã€‚æ•°æ®åŒ…ç”¨äºå­˜å‚¨ç¼–ç çš„æ•°æ®ï¼ˆä¾‹å¦‚ä¸€ä¸ªå‹ç¼©çš„è§†é¢‘å¸§ï¼‰ã€‚ if (!pkt): å¦‚æœæ•°æ®åŒ…åˆ†é…å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚ // åˆå§‹åŒ–æ•°æ®åŒ…å¹¶è®¾ç½®æ•°æ® av_init_packet(pkt); pkt-\u003edata = const_cast\u003cuint8_t*\u003e(data.data()); // Unsafe cast, data must be non-const pkt-\u003esize = data.size(); av_init_packet: åˆå§‹åŒ–åˆ†é…çš„æ•°æ®åŒ…ã€‚ pkt-\u003edata, pkt-\u003esize: è®¾ç½®æ•°æ®åŒ…çš„æ•°æ®æŒ‡é’ˆå’Œå¤§å°ã€‚data æ˜¯å‡½æ•°ä¼ å…¥çš„H.264æ•°æ®ã€‚ // å‘é€æ•°æ®åŒ…åˆ°è§£ç å™¨ int ret = avcodec_send_packet(context, pkt); if (ret \u003c 0) { std::cerr \u003c\u003c \"Error sending a packet for decoding.\\n\"; return false; } avcodec_send_packet: å°†æ•°æ®åŒ…å‘é€åˆ°è§£ç å™¨ï¼Œç­‰å¾…è§£ç ã€‚ if (ret \u003c 0): å¦‚æœå‘é€å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚ æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcv::Mat // åˆ†é…å¸§å­˜å‚¨è§£ç åçš„æ•°æ® AVFrame* frame = av_frame_alloc(); ret = avcodec_receive_frame(context, frame); if (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF) { av_frame_free(\u0026frame); break; } else if (ret \u003c 0) { std::cerr \u003c\u003c \"Error during decoding.\\n\"; return false; } av_frame_alloc: åˆ†é…ä¸€ä¸ªå¸§ç”¨äºå­˜å‚¨è§£ç åçš„æ•°æ®ã€‚ avcodec_receive_frame: ä»è§£ç å™¨ä¸­è·å–ä¸€ä¸ªè§£ç åçš„å¸§ã€‚ if (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF): æ£€æŸ¥æ˜¯å¦å…¨éƒ¨æ•°æ®å·²å¤„ç†å®Œæ¯•æˆ–éœ€è¦æ›´å¤šæ•°æ®ã€‚ // è½¬æ¢è§£ç åçš„å¸§ä¸ºcv::Matæ ¼å¼ SwsContext* img_convert_ctx = sws_getContext(frame-\u003ewidth, frame-\u003eheight, static_cast\u003cAVPixelFormat\u003e(frame-\u003eformat), frame-\u003ewidth, frame-\u003eheight, AV_PIX_FMT_BGR24, SWS_BICUBIC, NULL, NULL, NULL); int linesize[1] = {3 * frame-\u003ewidth}; // RGB stride image = cv::Mat(frame-\u003eheight, frame-\u003ewidth, CV_8UC3); sws_scale(img_convert_ctx, frame-\u003edata, frame-\u003elinesize, 0, frame-\u003eheight, \u0026image.data, linesize); sws_freeContext(img_convert_ctx); sws_getContext: åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºè½¬æ¢åƒç´ æ•°æ®æ ¼å¼ã€‚ sws_scale: è½¬æ¢åƒç´ æ•°æ®æ ¼å¼ä»è§£ç å¸§çš„æ ¼å¼åˆ°BGR24ï¼Œè¿™æ˜¯OpenCVå¸¸ç”¨çš„æ ¼å¼ã€‚ cv::Mat: åˆ›å»ºä¸€ä¸ªOpenCVçŸ©é˜µæ¥å­˜å‚¨å›¾åƒæ•°æ®ã€‚ è¿™ä¸ªæµç¨‹éœ€è¦åœ¨è§†é¢‘å¤„ç†çš„ç”Ÿå‘½å‘¨æœŸä¸­åªåˆå§‹åŒ–å’Œæ¸…ç†ä¸€æ¬¡ç¼–è§£ç å™¨ï¼Œè€Œå¸§å¤„ç†å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä»¥æé«˜æ€§èƒ½å’Œä¿æŒç¼–è§£ç å™¨çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†è§†é¢‘å¸§çš„å…¸å‹æ–¹æ³•ã€‚\nL4Z è§£å‹ç¼© L4Zè§£å‹ç¼©çš„è¿‡ç¨‹ç›¸å¯¹ç›´æ¥ï¼Œç›´æ¥æ ¹æ®å‡½æ•°æ¥å®ç°å³å¯ã€‚\nä»£ç å®ç° bool decompressLZ4Frame(const std::vector\u003cuint8_t\u003e\u0026 compressedData, cv::Mat\u0026 image, int width, int height) { std::vector\u003cuint8_t\u003e decompressedData(width * height * sizeof(uint16_t)); int decompressedSize = LZ4_decompress_safe(reinterpret_cast\u003cconst char*\u003e(compressedData.data()), reinterpret_cast\u003cchar*\u003e(decompressedData.data()), compressedData.size(), decompressedData.size()); if (decompressedSize \u003c 0) { std::cerr \u003c\u003c \"Failed to decompress LZ4 data.\" \u003c\u003c std::endl; return false; } image = cv::Mat(height, width, CV_16UC1, decompressedData.data()); cv::Mat pseudoColorImage(height, width, CV_8UC3); for (int i = 0; i \u003c height; i++) { for (int j = 0; j \u003c width; j++) { uint16_t disparity = image.at\u003cuint16_t\u003e(i, j); if (disparity \u003c 8192) { pseudoColorImage.at\u003ccv::Vec3b\u003e(i, j) = cv::Vec3b(pColorTable[disparity * 3 + 2], pColorTable[disparity * 3 + 1], pColorTable[disparity * 3]); } else { pseudoColorImage.at\u003ccv::Vec3b\u003e(i, j) = cv::Vec3b(0, 0, 0); } } } image = pseudoColorImage; return true; } è¿™é‡Œå¯¹è§£å‹ç¼©çš„è§†å·®å›¾è¿›è¡Œé¢œè‰²æ˜ å°„çš„å¤„ç†ï¼Œæ˜¯æ ¹æ®è§†å·®å€¼ç›´æ¥æ˜ å°„å¾—åˆ°\n",
  "wordCount" : "3226",
  "inLanguage": "zh",
  "datePublished": "2024-04-18T14:43:01+08:00",
  "dateModified": "2024-04-18T14:43:01+08:00",
  "author":[{
    "@type": "Person",
    "name": "YOUNG"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ahaknow.com/posts/know/decode-h.264-lz4-image-frames/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AhaKnow",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ahaknow.com/Q.gif"
    }
  }
}
</script>
    
    
    
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ahaknow.com/" accesskey="h" title="AhaKnow (Alt + H)">
                <img src="https://ahaknow.com/Q.gif" alt="" aria-label="logo"
                    height="35">AhaKnow</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ahaknow.com/search" title="ğŸª„é­”æ³• (Alt &#43; /)" accesskey=/>
                    <span>ğŸª„é­”æ³•</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/" title="ğŸ¡ä¸»é¡µ">
                    <span>ğŸ¡ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/posts" title="ğŸš€å¤©å¤©å‘ä¸Š">
                    <span>ğŸš€å¤©å¤©å‘ä¸Š</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/archives" title="â±ï¸æ—¶é—´çº¿">
                    <span>â±ï¸æ—¶é—´çº¿</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/tags" title="ğŸ·ï¸æ ‡ç­¾">
                    <span>ğŸ·ï¸æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/categories" title="ğŸ–‡å½’æ¡£">
                    <span>ğŸ–‡å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://ahaknow.com/toolkits" title="ğŸ§°åŒ»ç–—ç®±">
                    <span>ğŸ§°åŒ»ç–—ç®±</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ahaknow.com/">ğŸ¡ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://ahaknow.com/posts/">ğŸš€ å¤©å¤©å‘ä¸Š</a>&nbsp;Â»&nbsp;<a href="https://ahaknow.com/posts/know/">ğŸŒŸçŸ¥è¯†</a></div>
    <h1 class="post-title entry-hint-parent">
      å¼€å‘å®æˆ˜ï¼šè§£æH.264ç¼–ç å’ŒLZ4å‹ç¼©çš„ç›¸æœºå›¾åƒ
    </h1>
    <div class="post-meta">

























<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<span class="parent-post-meta">
        <span id="post_meta_style_1">
            <span class="fa fa-calendar-check-o"></span>
            <span>2024-04-18
                &nbsp;&nbsp;
            </span>
        </span>
        <span id="post_meta_style_2">
        <span class="fa fa-calendar-plus-o"></span>
        <span>2024-04-18
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>3226 å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>7 åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>YOUNG
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://ahaknow.com/tags/h.264/" style="color: var(--secondary)!important;">H.264</a>
            </span>
        </span>
    </span>
</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ğŸ“šç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%83%8c%e6%99%af%e7%9f%a5%e8%af%86" aria-label="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</a><ul>
                        
                <li>
                    <a href="#lz4" aria-label="LZ4">LZ4</a></li>
                <li>
                    <a href="#h264" aria-label="H.264">H.264</a></li>
                <li>
                    <a href="#h264-%e5%92%8c-qt" aria-label="H.264 å’Œ Qt">H.264 å’Œ Qt</a></li>
                <li>
                    <a href="#ffmpeg" aria-label="FFmpeg">FFmpeg</a></li>
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e4%b8%ad%e4%bd%bf%e7%94%a8lz4" aria-label="é¡¹ç›®ä¸­ä½¿ç”¨LZ4">é¡¹ç›®ä¸­ä½¿ç”¨LZ4</a></li>
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e4%b8%ad%e4%bd%bf%e7%94%a8ffmpeg" aria-label="é¡¹ç›®ä¸­ä½¿ç”¨FFmpeg">é¡¹ç›®ä¸­ä½¿ç”¨FFmpeg</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%9a%be%e7%82%b9%e5%88%86%e6%9e%90" aria-label="éš¾ç‚¹åˆ†æ">éš¾ç‚¹åˆ†æ</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-ffmpeg-%e8%a7%a3%e6%9e%90-h264-%e5%9b%be%e5%83%8f%e7%9a%84%e8%bf%87%e7%a8%8b%e5%92%8c%e5%8e%9f%e7%90%86" aria-label="ä½¿ç”¨ FFmpeg è§£æ H.264 å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç†">ä½¿ç”¨ FFmpeg è§£æ H.264 å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç†</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0" aria-label="ä»£ç å®ç°">ä»£ç å®ç°</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" aria-label="ä»£ç åˆ†æ">ä»£ç åˆ†æ</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e8%a7%a3%e7%a0%81%e5%99%a8" aria-label="åˆå§‹åŒ–è§£ç å™¨">åˆå§‹åŒ–è§£ç å™¨</a></li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e5%8d%95%e5%b8%a7%e6%95%b0%e6%8d%ae" aria-label="å¤„ç†å•å¸§æ•°æ®">å¤„ç†å•å¸§æ•°æ®</a></li>
                <li>
                    <a href="#%e6%8e%a5%e6%94%b6%e8%a7%a3%e7%a0%81%e5%90%8e%e7%9a%84%e5%b8%a7%e5%b9%b6%e8%bd%ac%e6%8d%a2%e4%b8%bacvmat" aria-label="æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcv::Mat">æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcv::Mat</a></li></ul>
                </li>
                <li>
                    <a href="#l4z-%e8%a7%a3%e5%8e%8b%e7%bc%a9" aria-label="L4Z è§£å‹ç¼©">L4Z è§£å‹ç¼©</a></li>
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0-1" aria-label="ä»£ç å®ç°">ä»£ç å®ç°</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
  <div class="post-content"><blockquote>
<p>åœ¨<a href="../parse-binary-file">ä¸Šä¸€ç¯‡</a>æ‰“é€šäº†è¯»å–å­—èŠ‚æµæ–‡ä»¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ¯ä¸€å¸§çš„å­—èŠ‚æ•°æ®äº†ï¼Œè¿™ä¸€ç¯‡å°±æ¥è§£å†³ä¸ºè¿™äº›æ•°æ®èµ‹äºˆå®é™…æ„ä¹‰ã€‚</p>
<p>å½©è‰²å›¾åƒé‡‡ç”¨H.264ç¼–ç  -&gt; é‚£å°±éœ€è¦æŒ‰ç…§H.264è§£ç </p>
<p>è§†å·®å›¾åƒé‡‡ç”¨LZ4å‹ç¼© -&gt; è§†å·®å›¾ä¿å­˜çš„16ä½æ— ç¬¦å·æ•´æ•°ï¼Œé‡‡ç”¨LZ4è§£å‹ç¼©ï¼ˆå¼€æºï¼‰</p>
</blockquote>
<h2 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†<a hidden class="anchor" aria-hidden="true" href="#èƒŒæ™¯çŸ¥è¯†">#</a></h2>
<h3 id="lz4">LZ4<a hidden class="anchor" aria-hidden="true" href="#lz4">#</a></h3>
<p><a href="https://lz4.org/"><strong>LZ4</strong></a> æ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿçš„å‹ç¼©ç®—æ³•ï¼Œæä¾›äº†å®æ—¶å‹ç¼©é€Ÿåº¦å’Œéå¸¸å¿«çš„è§£å‹ç¼©é€Ÿåº¦ï¼Œç”± Yann Colletï¼ˆFaceBookå¤§ä½¬ï¼‰ å¼€å‘ã€‚å®ƒå±äºæ— æŸå‹ç¼©ç®—æ³•ï¼Œæ„å‘³ç€å‹ç¼©åçš„æ•°æ®å¯ä»¥å®Œå…¨æ¢å¤åˆ°å…¶åŸå§‹å½¢æ€ã€‚LZ4 ä¸»è¦è®¾è®¡ç”¨äºéå¸¸é«˜é€Ÿçš„åœºæ™¯ï¼ˆè§£å‹é€Ÿåº¦å¯ä»¥è¾¾åˆ°æ•°GBæ¯ç§’ï¼‰ï¼Œä¾‹å¦‚å®æ—¶æ•°æ®ä¼ è¾“ã€æ—¥å¿—æ•°æ®å¤„ç†ç­‰ã€‚</p>
<h3 id="h264">H.264<a hidden class="anchor" aria-hidden="true" href="#h264">#</a></h3>
<p>H.264ï¼Œä¹Ÿè¢«ç§°ä¸ºMPEG-4 AVCï¼ˆAdvanced Video Codingï¼‰ï¼Œæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è§†é¢‘å‹ç¼©æ ‡å‡†ã€‚å®ƒæ˜¯ç”±å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITU-Tï¼‰ä¸‹çš„è§†é¢‘ç¼–ç ä¸“å®¶ç»„ï¼ˆVCEGï¼‰ä»¥åŠè¿åŠ¨å›¾åƒä¸“å®¶ç»„ï¼ˆMPEGï¼‰å…±åŒå¼€å‘çš„ã€‚H.264æ ‡å‡†çš„ç›®æ ‡æ˜¯æä¾›é«˜è´¨é‡çš„è§†é¢‘ä¼ è¾“ï¼ŒåŒæ—¶æ˜¾è‘—é™ä½æ¯”ç‰¹ç‡ï¼Œç›¸å¯¹äºä»¥å‰çš„æ ‡å‡†å¦‚MPEG-2å’ŒMPEG-4 Part 2ï¼Œå®ƒåœ¨ä¿æŒç›¸åŒè§†è§‰è´¨é‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿æ–‡ä»¶å¤§å°å‡å°‘åˆ°åŸæ¥çš„ä¸€åŠä»¥ä¸Šã€‚</p>
<h3 id="h264-å’Œ-qt">H.264 å’Œ Qt<a hidden class="anchor" aria-hidden="true" href="#h264-å’Œ-qt">#</a></h3>
<p>Qt ä½¿ç”¨ <strong>Qt Multimedia</strong> æ¨¡å—æ¥å¤„ç†å¤šåª’ä½“å†…å®¹ï¼ŒåŒ…æ‹¬è§†é¢‘å’ŒéŸ³é¢‘ã€‚è¿™ä¸ªæ¨¡å—æ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ H.264ã€‚ä½¿ç”¨ Qt Multimediaï¼Œå¼€å‘è€…å¯ä»¥è¾ƒå®¹æ˜“åœ°åœ¨åº”ç”¨ä¸­é›†æˆè§†é¢‘æ’­æ”¾åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¤„ç†åº•å±‚çš„è§†é¢‘è§£ç ã€‚</p>
<ul>
<li><strong>Qt Multimedia Widgets</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>QMediaPlayer</code> å’Œ <code>QVideoWidget</code> æ¥æ’­æ”¾ H.264 è§†é¢‘ã€‚Qt å¤„ç†å¤šåª’ä½“æµçš„è§£ç å’Œæ¸²æŸ“ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨å¦‚ä½•æ§åˆ¶æ’­æ”¾å™¨å’Œé›†æˆåˆ°UIä¸­ã€‚</li>
<li><strong>è‡ªåŠ¨è§£ç </strong>ï¼šQt åº•å±‚ä½¿ç”¨ç³»ç»Ÿçš„ç¼–è§£ç åº“ï¼ˆå¦‚ DirectShow on Windows, GStreamer on Linuxï¼‰æ¥è§£ç è§†é¢‘æµï¼ŒåŒ…æ‹¬ H.264ã€‚è¿™æ„å‘³ç€é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è§£æ H.264 æ•°æ®å¸§ï¼Œé™¤ééœ€è¦éå¸¸å®šåˆ¶åŒ–çš„å¤„ç†ã€‚</li>
</ul>
<h3 id="ffmpeg">FFmpeg<a hidden class="anchor" aria-hidden="true" href="#ffmpeg">#</a></h3>
<p><strong>FFmpeg</strong> æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šåª’ä½“æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€å¥—å…¨é¢çš„åº“å’Œå·¥å…·ï¼Œç”¨äºå¤„ç†è§†é¢‘ã€éŸ³é¢‘å’Œå…¶ä»–å¤šåª’ä½“æ–‡ä»¶å’Œæµã€‚è¿™ä¸ªæ¡†æ¶æ”¯æŒè½¬ç ã€è½¬æµã€æ’­æ”¾å’Œåˆ†æå‡ ä¹æ‰€æœ‰ç±»å‹çš„å¤šåª’ä½“æ•°æ®ã€‚FFmpeg åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦ç»„ä»¶ï¼š</p>
<ul>
<li><strong>libavcodec</strong>: æä¾›å¹¿æ³›çš„ç¼–è§£ç å™¨æ”¯æŒï¼Œæ˜¯å¤„ç†è§†é¢‘å’ŒéŸ³é¢‘ç¼–è§£ç çš„æ ¸å¿ƒåº“ã€‚</li>
<li><strong>libavformat</strong>: å¤„ç†å¤šç§éŸ³è§†é¢‘å®¹å™¨æ ¼å¼çš„è¾“å…¥å’Œè¾“å‡ºã€‚</li>
<li><strong>libavutil</strong>: åŒ…å«ä¸€äº›è¾…åŠ©çš„å®ç”¨åŠŸèƒ½ï¼Œå¦‚æ—¥å¿—ç®¡ç†å’Œé”™è¯¯å¤„ç†ã€‚</li>
<li><strong>libavfilter</strong>: æä¾›è§†é¢‘å’ŒéŸ³é¢‘æµçš„è½¬æ¢å’Œæ“ä½œåŠŸèƒ½ã€‚</li>
<li><strong>libswscale</strong>: å¤„ç†å›¾åƒè‰²å½©å’Œåƒç´ æ ¼å¼è½¬æ¢ã€‚</li>
<li><strong>libswresample</strong>: å¤„ç†éŸ³é¢‘é‡‡æ ·æ•°æ®çš„è½¬æ¢ã€‚</li>
</ul>
<h3 id="é¡¹ç›®ä¸­ä½¿ç”¨lz4">é¡¹ç›®ä¸­ä½¿ç”¨LZ4<a hidden class="anchor" aria-hidden="true" href="#é¡¹ç›®ä¸­ä½¿ç”¨lz4">#</a></h3>
<p>é¦–å…ˆå®‰è£… <code>liblz4-dev</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt install liblz4-dev
</span></span></code></pre></div><p>æœ‰å¯èƒ½ CMake ä»ç„¶æ‰¾ä¸åˆ° LZ4ï¼Œè¿™æ—¶å€™å¯ä»¥æ‰‹åŠ¨æŒ‡å®š LZ4 åº“å’Œå¤´æ–‡ä»¶çš„è·¯å¾„ã€‚é¦–å…ˆéœ€è¦ç¡®å®š <code>liblz4.so</code> å’Œ LZ4 çš„å¤´æ–‡ä»¶ <code>lz4.h</code> çš„ä½ç½®ã€‚è¿™äº›æ–‡ä»¶é€šå¸¸ä½äº <code>/usr/include</code> å’Œ <code>/usr/lib</code> ä¸‹ï¼Œ<strong>å¦‚æœä¸ç¡®å®šå¯ä»¥é€šè¿‡ <code>find /usr -name lz4.h</code>å‘½ä»¤æŸ¥æ‰¾</strong> ã€‚</p>
<p>ä¿®æ”¹ <code>CMakeLists.txt</code> æ–‡ä»¶ï¼Œæ‰‹åŠ¨è®¾ç½®è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmake" data-lang="cmake"><span class="line"><span class="cl"><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">3.10</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">project</span><span class="p">(</span><span class="s">DataFrameParser</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span> <span class="s">20</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD_REQUIRED</span> <span class="s">True</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Find OpenCV
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">find_package</span><span class="p">(</span><span class="s">OpenCV</span> <span class="s">REQUIRED</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Include directories for OpenCV and manually for LZ4
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">include_directories</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">OpenCV_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="s">/usr/include</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Link directories for LZ4
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">link_directories</span><span class="p">(</span><span class="s">/usr/lib</span> <span class="s">/usr/lib/x86_64-linux-gnu</span><span class="p">)</span>  <span class="c"># Adjust this path according to your system
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">DataFrameParser</span> <span class="s">main.cpp</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">DataFrameParser</span> <span class="s">lz4</span> <span class="o">${</span><span class="nv">OpenCV_LIBS</span><span class="o">}</span><span class="p">)</span><span class="err">
</span></span></span></code></pre></div><p>è¿™é‡Œï¼Œè¿™é‡Œä½¿ç”¨äº† <code>link_directories</code> å’Œ <code>target_link_libraries</code> ä¸­ç›´æ¥æŒ‡å®š <code>lz4</code>ï¼Œè€Œä¸æ˜¯ <code>${LZ4_LIBRARIES}</code>ã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨ <code>find_package</code> æ¥å®šä¹‰ <code>LZ4_LIBRARIES</code> å˜é‡ã€‚</p>
<h3 id="é¡¹ç›®ä¸­ä½¿ç”¨ffmpeg">é¡¹ç›®ä¸­ä½¿ç”¨FFmpeg<a hidden class="anchor" aria-hidden="true" href="#é¡¹ç›®ä¸­ä½¿ç”¨ffmpeg">#</a></h3>
<p><strong>å®‰è£… FFmpeg å’Œç›¸åº”çš„å¼€å‘åº“</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt install ffmpeg
</span></span><span class="line"><span class="cl">sudo apt install libavcodec-dev libavformat-dev libswscale-dev libavutil-dev
</span></span></code></pre></div><p>è¿™äº›å¼€å‘åº“åŒ…æ‹¬ç”¨äºå¤„ç†è§†é¢‘ç¼–è§£ç çš„ <code>libavcodec</code>ï¼Œç”¨äºå¤„ç†å¤šåª’ä½“å®¹å™¨æ ¼å¼çš„ <code>libavformat</code>ï¼Œä»¥åŠç”¨äºè§†é¢‘ç¼©æ”¾å’Œæ ¼å¼è½¬æ¢çš„ <code>libswscale</code> ç­‰ã€‚</p>
<p>åœ¨ CMake é¡¹ç›®ä¸­ä½¿ç”¨ FFmpegï¼Œåˆ™éœ€è¦åœ¨ <code>CMakeLists.txt</code> æ–‡ä»¶ä¸­æ­£ç¡®è®¾ç½®æ‰¾åˆ°å’Œé“¾æ¥è¿™äº›åº“ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmake" data-lang="cmake"><span class="line"><span class="cl"><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">3.10</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">project</span><span class="p">(</span><span class="s">DataFrameParser</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span> <span class="s">20</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD_REQUIRED</span> <span class="s">True</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Find OpenCV
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">find_package</span><span class="p">(</span><span class="s">OpenCV</span> <span class="s">REQUIRED</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Find FFmpeg components
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">find_package</span><span class="p">(</span><span class="s">PkgConfig</span> <span class="s">REQUIRED</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">pkg_check_modules</span><span class="p">(</span><span class="s">AVCODEC</span> <span class="s">REQUIRED</span> <span class="s">libavcodec</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">pkg_check_modules</span><span class="p">(</span><span class="s">AVFORMAT</span> <span class="s">REQUIRED</span> <span class="s">libavformat</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">pkg_check_modules</span><span class="p">(</span><span class="s">SWSCALE</span> <span class="s">REQUIRED</span> <span class="s">libswscale</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">pkg_check_modules</span><span class="p">(</span><span class="s">AVUTIL</span> <span class="s">REQUIRED</span> <span class="s">libavutil</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">include_directories</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">OpenCV_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVCODEC_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVFORMAT_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">SWSCALE_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVUTIL_INCLUDE_DIRS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">DataFrameParser</span> <span class="s">main.cpp</span><span class="p">)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">DataFrameParser</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">OpenCV_LIBS</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVCODEC_LIBRARIES</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVFORMAT_LIBRARIES</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">SWSCALE_LIBRARIES</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">${</span><span class="nv">AVUTIL_LIBRARIES</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="err">
</span></span></span></code></pre></div><h2 id="éš¾ç‚¹åˆ†æ">éš¾ç‚¹åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#éš¾ç‚¹åˆ†æ">#</a></h2>
<p>ä¸ä½¿ç”¨QTï¼Œå¸Œæœ›èƒ½å¤Ÿè½¬æ¢ä¸ºOpenCVå¤„ç†çš„å›¾åƒï¼Œ<strong>å› æ­¤éœ€è¦ä½¿ç”¨åˆ°FFmpeg</strong>ã€‚</p>
<p><mark>ç”±äºå¤„ç†çš„å­—èŠ‚æµï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿è¯èƒ½å¤ŸæŒç»­çš„è§£ç ã€‚ä¹Ÿå°±æ˜¯éœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç„¶åæŒç»­è¿è¡Œï¼Œè¿è¡Œç»“æŸåé‡Šæ”¾èµ„æºã€‚</mark></p>
<h3 id="ä½¿ç”¨-ffmpeg-è§£æ-h264-å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç†">ä½¿ç”¨ FFmpeg è§£æ H.264 å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç†<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-ffmpeg-è§£æ-h264-å›¾åƒçš„è¿‡ç¨‹å’ŒåŸç†">#</a></h3>
<ol>
<li>
<p><strong>åˆå§‹åŒ–å’Œé…ç½®è§£ç å™¨ï¼ˆè¿™éƒ¨åˆ†åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼‰</strong></p>
<ul>
<li><strong>æŸ¥æ‰¾å¹¶æ‰“å¼€è§£ç å™¨</strong>:ä½¿ç”¨ <code>avcodec_find_decoder</code> æ ¹æ®æŒ‡å®šçš„ç¼–è§£ç å™¨IDï¼ˆä¾‹å¦‚ <code>AV_CODEC_ID_H264</code>ï¼‰æ¥æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨ã€‚ç„¶åä½¿ç”¨ <code>avcodec_alloc_context3</code> å’Œ <code>avcodec_open2</code> æ¥åˆ†é…å¹¶åˆå§‹åŒ–è§£ç å™¨ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>è®¾ç½®è§£ç ä¸Šä¸‹æ–‡</strong>:é…ç½®è§£ç å™¨ä¸Šä¸‹æ–‡ï¼Œå¦‚è®¾ç½®æ—¶é—´åŸºã€å»¶è¿Ÿç­‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>è§£ç è¿‡ç¨‹</strong></p>
</li>
</ol>
<ul>
<li><strong>è¯»å–å’Œå‘é€æ•°æ®åŒ…</strong>:ä»æºæ•°æ®ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œæµï¼‰ä¸­è¯»å–æ•°æ®ï¼Œå¹¶æ„å»ºæˆ <code>AVPacket</code>ã€‚ä½¿ç”¨ <code>av_read_frame</code> ä»å¤šåª’ä½“æ–‡ä»¶è¯»å–æ•°æ®å¸§æˆ–ä½¿ç”¨ <code>av_init_packet</code> å¤„ç†è‡ªå®šä¹‰çš„æ•°æ®ï¼Œç„¶åä½¿ç”¨ <code>avcodec_send_packet</code> å°†æ•°æ®åŒ…å‘é€ç»™è§£ç å™¨ã€‚</li>
<li><strong>æ¥æ”¶å’Œè§£ç </strong>:ä½¿ç”¨ <code>avcodec_receive_frame</code> æ¥æ”¶è§£ç å™¨è¾“å‡ºçš„å¸§ã€‚è¯¥å‡½æ•°ä»è§£ç å™¨ä¸­æå–ä¸€ä¸ªè§£ç å¥½çš„å¸§ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®è§£ç ä¸€ä¸ªå®Œæ•´çš„å¸§ï¼Œå®ƒä¼šè¿”å› <code>EAGAIN</code>ã€‚</li>
<li><strong>å›¾åƒè½¬æ¢</strong>:ä½¿ç”¨ <code>libswscale</code>ï¼ˆæˆ– <code>SwsContext</code>ï¼‰å°†è§£ç åçš„å¸§ï¼ˆé€šå¸¸ä¸ºYUVæ ¼å¼ï¼‰è½¬æ¢ä¸ºå…¶ä»–åƒç´ æ ¼å¼ï¼ˆå¦‚RGBï¼‰ï¼Œä»¥ä¾¿äºæ˜¾ç¤ºæˆ–è¿›ä¸€æ­¥å¤„ç†ã€‚</li>
</ul>
<ol start="3">
<li><strong>èµ„æºæ¸…ç†</strong>
<ul>
<li><strong>é‡Šæ”¾èµ„æº</strong>:ä½¿ç”¨ <code>av_frame_free</code>ã€<code>av_packet_free</code> å’Œ <code>avcodec_close</code> é‡Šæ”¾å¸§ã€æ•°æ®åŒ…å’Œå…³é—­è§£ç å™¨ã€‚</li>
</ul>
</li>
</ol>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å®ç°">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å…¨å±€å˜é‡æˆ–ç±»æˆå‘˜å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">AVCodecContext</span><span class="o">*</span> <span class="n">context</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">initializeDecoder</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AVCodec</span><span class="o">*</span> <span class="n">codec</span> <span class="o">=</span> <span class="n">avcodec_find_decoder</span><span class="p">(</span><span class="n">AV_CODEC_ID_H264</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">codec</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Codec not found.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">context</span> <span class="o">=</span> <span class="n">avcodec_alloc_context3</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not allocate video codec context.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">avcodec_open2</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not open codec.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">avcodec_free_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">cleanupDecoder</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">avcodec_close</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">avcodec_free_context</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">processH264Frame</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span> <span class="n">data</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AVPacket</span><span class="o">*</span> <span class="n">pkt</span> <span class="o">=</span> <span class="n">av_packet_alloc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pkt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not allocate AVPacket.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">av_init_packet</span><span class="p">(</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// set data source
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pkt</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>  <span class="c1">// Unsafe cast, data must be non-const
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pkt</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">avcodec_send_packet</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Error sending a packet for decoding.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">av_packet_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">AVFrame</span><span class="o">*</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">av_frame_alloc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span> <span class="o">=</span> <span class="n">avcodec_receive_frame</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">AVERROR</span><span class="p">(</span><span class="n">EAGAIN</span><span class="p">)</span> <span class="o">||</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">AVERROR_EOF</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">av_frame_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">av_packet_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Error during decoding.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">av_frame_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">av_packet_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Convert AVFrame to cv::Mat
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// yuvj420p
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Pixel Format: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">av_get_pix_fmt_name</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">AVPixelFormat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Pixel Format Enum: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">format</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SwsContext</span><span class="o">*</span> <span class="n">img_convert_ctx</span> <span class="o">=</span> <span class="n">sws_getContext</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                 <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">AVPixelFormat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                                 <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="n">AV_PIX_FMT_BGR24</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                 <span class="n">SWS_BICUBIC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">linesize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span> <span class="o">*</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">};</span>  <span class="c1">// RGB stride
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">sws_scale</span><span class="p">(</span><span class="n">img_convert_ctx</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">linesize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">linesize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">sws_freeContext</span><span class="p">(</span><span class="n">img_convert_ctx</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">av_frame_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">av_packet_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ä»£ç åˆ†æ">#</a></h3>
<p><strong>ç”±äºSPSï¼ˆåºåˆ—å‚æ•°é›†ï¼‰å’ŒPPSï¼ˆå›¾åƒå‚æ•°é›†ï¼‰ç­‰å…³é”®è§£ç ä¿¡æ¯é€šå¸¸åªåœ¨è§†é¢‘æµçš„å¼€å§‹éƒ¨åˆ†å‘é€ï¼Œå› æ­¤åªéœ€è¦åˆå§‹åŒ–è§£ç å™¨ä¸€æ¬¡</strong>ã€‚ï¼ˆæœ€å¼€å§‹çš„å®ç°æ˜¯æ¯æ¬¡è§£ç å¸§ä¹‹å‰éƒ½é‡æ–°åˆå§‹åŒ–è§£ç å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™äº›å…³é”®ä¿¡æ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œå¯¼è‡´åç»­å¸§æ— æ³•æ­£ç¡®è§£ç ï¼Œ<strong>è¡¨ç°çš„ç°è±¡æ˜¯å¡åœ¨äº†ç¬¬ä¸€å¸§ç”»é¢</strong>ï¼‰ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸Šè¿°ä»£ç çš„é€è¡Œè§£é‡Šï¼š</p>
<h4 id="åˆå§‹åŒ–è§£ç å™¨">åˆå§‹åŒ–è§£ç å™¨<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–è§£ç å™¨">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// æ‰¾åˆ°å¹¶ç¡®è®¤è§£ç å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">AVCodec</span><span class="o">*</span> <span class="n">codec</span> <span class="o">=</span> <span class="n">avcodec_find_decoder</span><span class="p">(</span><span class="n">AV_CODEC_ID_H264</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">codec</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Codec not found.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>avcodec_find_decoder</code>: è¿™ä¸ªå‡½æ•°ç”¨äºæŸ¥æ‰¾æŒ‡å®šç¼–è§£ç å™¨ï¼ˆè¿™é‡Œæ˜¯H.264ï¼‰ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘è§£ç å™¨çš„æŒ‡é’ˆã€‚</li>
<li><code>if (!codec)</code>: å¦‚æœæ²¡æœ‰æ‰¾åˆ°è§£ç å™¨ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// åˆ†é…ç¼–è§£ç å™¨ä¸Šä¸‹æ–‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">AVCodecContext</span><span class="o">*</span> <span class="n">context</span> <span class="o">=</span> <span class="n">avcodec_alloc_context3</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not allocate video codec context.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>avcodec_alloc_context3</code>: åˆ†é…ä¸€ä¸ªæ–°çš„è§£ç å™¨ä¸Šä¸‹æ–‡ï¼Œå…³è”ç»™å®šçš„ç¼–è§£ç å™¨ã€‚</li>
<li><code>if (!context)</code>: å¦‚æœä¸Šä¸‹æ–‡åˆ†é…å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// æ‰“å¼€è§£ç å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">avcodec_open2</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not open codec.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>avcodec_open2</code>: åˆå§‹åŒ–è§£ç å™¨ä¸Šä¸‹æ–‡ä»¥å‡†å¤‡ä½¿ç”¨ï¼Œä¼ å…¥çš„ <code>codec</code> æ˜¯ä¸Šæ–‡æŸ¥æ‰¾å¾—åˆ°çš„ç¼–è§£ç å™¨ã€‚</li>
<li><code>if (avcodec_open2(...) &lt; 0)</code>: å¦‚æœè§£ç å™¨æ‰“å¼€å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚</li>
</ul>
<h4 id="å¤„ç†å•å¸§æ•°æ®">å¤„ç†å•å¸§æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#å¤„ç†å•å¸§æ•°æ®">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// åˆ†é…æ•°æ®åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">AVPacket</span><span class="o">*</span> <span class="n">pkt</span> <span class="o">=</span> <span class="n">av_packet_alloc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pkt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Could not allocate AVPacket.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>av_packet_alloc</code>: åˆ†é…ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ã€‚æ•°æ®åŒ…ç”¨äºå­˜å‚¨ç¼–ç çš„æ•°æ®ï¼ˆä¾‹å¦‚ä¸€ä¸ªå‹ç¼©çš„è§†é¢‘å¸§ï¼‰ã€‚</li>
<li><code>if (!pkt)</code>: å¦‚æœæ•°æ®åŒ…åˆ†é…å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// åˆå§‹åŒ–æ•°æ®åŒ…å¹¶è®¾ç½®æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">av_init_packet</span><span class="p">(</span><span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">pkt</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>  <span class="c1">// Unsafe cast, data must be non-const
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pkt</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span></code></pre></div><ul>
<li><code>av_init_packet</code>: åˆå§‹åŒ–åˆ†é…çš„æ•°æ®åŒ…ã€‚</li>
<li><code>pkt-&gt;data</code>, <code>pkt-&gt;size</code>: è®¾ç½®æ•°æ®åŒ…çš„æ•°æ®æŒ‡é’ˆå’Œå¤§å°ã€‚<code>data</code> æ˜¯å‡½æ•°ä¼ å…¥çš„H.264æ•°æ®ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// å‘é€æ•°æ®åŒ…åˆ°è§£ç å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">avcodec_send_packet</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Error sending a packet for decoding.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>avcodec_send_packet</code>: å°†æ•°æ®åŒ…å‘é€åˆ°è§£ç å™¨ï¼Œç­‰å¾…è§£ç ã€‚</li>
<li><code>if (ret &lt; 0)</code>: å¦‚æœå‘é€å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›å¤±è´¥ã€‚</li>
</ul>
<h4 id="æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcvmat">æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcv::Mat<a hidden class="anchor" aria-hidden="true" href="#æ¥æ”¶è§£ç åçš„å¸§å¹¶è½¬æ¢ä¸ºcvmat">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// åˆ†é…å¸§å­˜å‚¨è§£ç åçš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">AVFrame</span><span class="o">*</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">av_frame_alloc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">avcodec_receive_frame</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">AVERROR</span><span class="p">(</span><span class="n">EAGAIN</span><span class="p">)</span> <span class="o">||</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">AVERROR_EOF</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">av_frame_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Error during decoding.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>av_frame_alloc</code>: åˆ†é…ä¸€ä¸ªå¸§ç”¨äºå­˜å‚¨è§£ç åçš„æ•°æ®ã€‚</li>
<li><code>avcodec_receive_frame</code>: ä»è§£ç å™¨ä¸­è·å–ä¸€ä¸ªè§£ç åçš„å¸§ã€‚</li>
<li><code>if (ret == AVERROR(EAGAIN) || ret == AVERROR_EOF)</code>: æ£€æŸ¥æ˜¯å¦å…¨éƒ¨æ•°æ®å·²å¤„ç†å®Œæ¯•æˆ–éœ€è¦æ›´å¤šæ•°æ®ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// è½¬æ¢è§£ç åçš„å¸§ä¸ºcv::Matæ ¼å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SwsContext</span><span class="o">*</span> <span class="n">img_convert_ctx</span> <span class="o">=</span> <span class="n">sws_getContext</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">AVPixelFormat</span><span class="o">&gt;</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">format</span><span class="p">),</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="n">AV_PIX_FMT_BGR24</span><span class="p">,</span> <span class="n">SWS_BICUBIC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">linesize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span> <span class="o">*</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">};</span>  <span class="c1">// RGB stride
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sws_scale</span><span class="p">(</span><span class="n">img_convert_ctx</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">linesize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">linesize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sws_freeContext</span><span class="p">(</span><span class="n">img_convert_ctx</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li><code>sws_getContext</code>: åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç”¨äºè½¬æ¢åƒç´ æ•°æ®æ ¼å¼ã€‚</li>
<li><code>sws_scale</code>: è½¬æ¢åƒç´ æ•°æ®æ ¼å¼ä»è§£ç å¸§çš„æ ¼å¼åˆ°BGR24ï¼Œè¿™æ˜¯OpenCVå¸¸ç”¨çš„æ ¼å¼ã€‚</li>
<li><code>cv::Mat</code>: åˆ›å»ºä¸€ä¸ªOpenCVçŸ©é˜µæ¥å­˜å‚¨å›¾åƒæ•°æ®ã€‚</li>
</ul>
<p><strong>è¿™ä¸ªæµç¨‹éœ€è¦åœ¨è§†é¢‘å¤„ç†çš„ç”Ÿå‘½å‘¨æœŸä¸­åªåˆå§‹åŒ–å’Œæ¸…ç†ä¸€æ¬¡ç¼–è§£ç å™¨ï¼Œè€Œå¸§å¤„ç†å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä»¥æé«˜æ€§èƒ½å’Œä¿æŒç¼–è§£ç å™¨çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†è§†é¢‘å¸§çš„å…¸å‹æ–¹æ³•ã€‚</strong></p>
<h3 id="l4z-è§£å‹ç¼©">L4Z è§£å‹ç¼©<a hidden class="anchor" aria-hidden="true" href="#l4z-è§£å‹ç¼©">#</a></h3>
<p>L4Zè§£å‹ç¼©çš„è¿‡ç¨‹ç›¸å¯¹ç›´æ¥ï¼Œç›´æ¥æ ¹æ®å‡½æ•°æ¥å®ç°å³å¯ã€‚</p>
<h3 id="ä»£ç å®ç°-1">ä»£ç å®ç°<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å®ç°-1">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">decompressLZ4Frame</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span> <span class="n">compressedData</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">decompressedData</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">decompressedSize</span> <span class="o">=</span> <span class="n">LZ4_decompress_safe</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">compressedData</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">                                               <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">decompressedData</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">                                               <span class="n">compressedData</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                                               <span class="n">decompressedData</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">decompressedSize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Failed to decompress LZ4 data.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">CV_16UC1</span><span class="p">,</span> <span class="n">decompressedData</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">pseudoColorImage</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint16_t</span> <span class="n">disparity</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">disparity</span> <span class="o">&lt;</span> <span class="mi">8192</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">pseudoColorImage</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="p">(</span><span class="n">pColorTable</span><span class="p">[</span><span class="n">disparity</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                                                  <span class="n">pColorTable</span><span class="p">[</span><span class="n">disparity</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                                                  <span class="n">pColorTable</span><span class="p">[</span><span class="n">disparity</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">pseudoColorImage</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">pseudoColorImage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><mark>è¿™é‡Œå¯¹è§£å‹ç¼©çš„è§†å·®å›¾è¿›è¡Œé¢œè‰²æ˜ å°„çš„å¤„ç†ï¼Œæ˜¯æ ¹æ®è§†å·®å€¼ç›´æ¥æ˜ å°„å¾—åˆ°</mark></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ahaknow.com/tags/h.264/">H.264</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://ahaknow.com/posts/know/parse-binary-file/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>å¼€å‘å®æˆ˜ï¼šè§£æäºŒè¿›åˆ¶æ–‡ä»¶</span>
  </a>
</nav>

  </footer>
</article>
</main>

<footer class="footer">
    <span>&copy; 2024 <a href="https://ahaknow.com/">AhaKnow</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/IHKYoung/CKPaper/" rel="noopener" target="_blank">CKPaper</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'ğŸ–¨ï¸æ‰“å°';

        function copyingDone() {
            copybutton.innerHTML = 'ğŸ“‹å¤‡ä»½';
            setTimeout(() => {
                copybutton.innerHTML = 'ğŸ–¨ï¸æ‰“å°';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                
                
                let copyText = codeblock.textContent + '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' + 'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"AhaKnow"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' + '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(copyText);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('pre > code[class*="language-"]').forEach(function(codeblock) {
            
            
            let language = codeblock.className.match(/language-(\w+)/)[1] || "code";

            
            let macCodeBlock = document.createElement("div");
            let macButtons = document.createElement("div");
            let buttons = ['close', 'minimize', 'maximize'].map(function(className) {
                let button = document.createElement("div");
                button.setAttribute('class', `mac-button ${className}`);
                return button;
            });
            let languageType = document.createElement("div");
            languageType.innerText = language;
            languageType.setAttribute('class', 'language-type');

            
            macButtons.setAttribute('class', 'mac-buttons');
            buttons.forEach(function(button) {
                macButtons.appendChild(button);
            });
            macCodeBlock.appendChild(macButtons);
            macCodeBlock.appendChild(languageType);
            macCodeBlock.setAttribute('class', 'mac-code-block');

            
            codeblock.parentNode.insertBefore(macCodeBlock, codeblock);
        });
    });
</script>


</body>

</html>
